---
config:
  layout: fixed
  look: neo
  themeVariables:
    fontSize: 20px
---
flowchart TB
    A311["<b>3.1.1 資料來源<br></b>TEJ 台灣股票市場日頻資料 CSV 匯出供後續處理與訓練"] --> A312["<b>3.1.2 TEJ 資料欄位與研究變數表格<br></b>表 1 原始欄位彙整<br>表 2 特徵摘要<br>附錄表 3 完整特徵清單"]
    A312 --> A313["<b>3.1.3 資料預處理<br></b>排序與格式統一<br>技術特徵計算<br>標籤計算<br>圖結構建構<br>張量化整理<br>缺失值處理<br>BatchNorm 正規化策略"]
    A313 --> A314["<b>3.1.4 資料集劃分<br></b>時間序列切分避免資料洩漏<br>80% 訓練/20% 測試<br>短期/中期/長期 三種樣本長度"]
    A314 --> B321["<b>3.2.1 特徵選取與分類<br></b>54 項輸入特徵<br>報酬/反轉/趨勢/波動 等技術指標"]
    B321 --> B322["<b>3.2.2 圖結構設計與建構流程<br></b>產業圖：同產業完全連結加 self loop<br>全市場圖：完全圖加 self loop<br>以 edge index 表示並保存為 artifacts"]
    B322 --> C331["<b>3.3.1 基準模型 GATRegressor<br></b>兩層 GAT 在產業圖上訊息傳遞<br>線性層輸出預測值"] & C332["<b>3.3.2 DMFM 模型架構<br></b>特徵編碼<br>產業與市場中性化<br>深度因子學習及因子注意力"]
    C331 --> D341["<b>3.4.1 總損失函數<br></b>注意力誤差項、IC 相關項、因子收益項<br>並搭配 AdamW 與 weight decay"]
    C332 --> D341
    D341 --> E351["<b>3.5.1 預測品質指標<br></b>IC/ICIR<br>MSE/RMSE/MAE"]
    E351 --> E352["<b>3.5.2 投資組合績效指標<br></b>依預測分數排序<br>選 top pct 股票等權做多<br>計算年化報酬/Sharpe ratio/勝率"]
    E352 --> E353["<b>3.5.3 基準比較<br></b>Naive baseline 預測固定為 0<br>0050 作為市場基準<br>輸出 IC 分佈與累積報酬視覺化<br>DMFM 額外輸出注意力權重分佈"]

    A311@{ shape: rect}
    A312@{ shape: rect}
    A313@{ shape: rect}
    A314@{ shape: rect}
    B321@{ shape: rect}
    B322@{ shape: rect}
    C331@{ shape: rect}
    C332@{ shape: rect}
    D341@{ shape: rect}
    E351@{ shape: rect}
    E352@{ shape: rect}
    E353@{ shape: rect}