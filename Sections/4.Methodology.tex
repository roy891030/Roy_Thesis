\chapter{實驗結果}
\label{ch:results}

本章整理各模型在相同資料切分下的測試結果，從（1）預測能力、（2）投組績效、（3）DMFM 特徵權重三個面向進行比較。

\section{模型對比}
\label{sec:model_comparison}

\subsection{評估指標說明}

本研究比較五個模型（Linear、XGBoost、LSTM、GAT、DMFM）在三種時間窗（Short/Medium/Long）之測試表現。指標設計分成兩類：RMSE/MAE 用於衡量點預測誤差，IC/ICIR/DirAcc 用於衡量排序與方向判斷是否可用於選股決策。

\begin{itemize}
  \item \textbf{RMSE}：$\sqrt{\frac{1}{M}\sum_{t,i}(\hat{y}_{i,t}-y_{i,t})^2}$。
  \item \textbf{MAE}：$\frac{1}{M}\sum_{t,i}\left|\hat{y}_{i,t}-y_{i,t}\right|$。
  \item \textbf{IC}：以每日截面相關係數 $IC_t=\mathrm{corr}(\hat{y}_{:,t},y_{:,t})$ 計算，再彙整其平均值。
  \item \textbf{ICIR}：$\frac{\mathrm{mean}(IC_t)}{\mathrm{std}(IC_t)}$，衡量排序訊號的穩定性。
  \item \textbf{DirAcc}：$\frac{1}{M}\sum_{t,i}\mathbf{1}\!\left[\mathrm{sign}(\hat{y}_{i,t})=\mathrm{sign}(y_{i,t})\right]$。
\end{itemize}

其中 $M$ 為測試集中「交易日$\times$股票」樣本總數，$\hat{y}_{i,t}$ 與 $y_{i,t}$ 分別為模型預測值與實際報酬。

\subsection{模型比較結果}

\begin{samepage}
\input{Sections/tables/results_pred_metrics.tex}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.86\textwidth]{img/results_model_comparison_metrics.png}
  \caption{各模型在不同時間窗之關鍵預測指標比較（ICIR、IC、RMSE、DirAcc）。}
  \label{fig:results_model_comparison_metrics}
\end{figure}
表 \ref{tab:results_pred_metrics} 先呈現完整數值，圖 \ref{fig:results_model_comparison_metrics} 進一步以視覺化方式呈現同一組比較結果，便於跨模型與跨時間窗對照。
\end{samepage}

由表 \ref{tab:results_pred_metrics} 與圖 \ref{fig:results_model_comparison_metrics} 可得：
\begin{itemize}
  \item \textbf{誤差表現}：點預測誤差仍以 Linear/XGBoost 較低；DMFM 與 GAT 的 RMSE/MAE 較高，顯示排序訊號優勢不必然伴隨最小化誤差。
  \item \textbf{排序能力}：DMFM 在 Short/Medium 的 IC 與 DirAcc 皆為最佳；在 Long 視窗中，DMFM 與 XGBoost 的 IC 接近（0.0834 vs 0.0837），且 DMFM 的 ICIR 最高（0.7854）。
  \item \textbf{模型定位差異}：DMFM 在排序相關指標與方向準確率上有明顯提升，而 Linear/XGBoost 仍在誤差指標上保有優勢。
\end{itemize}
其餘預測輸出（含 MSE、Daily IC 與完整模型彙整）見附錄 \ref{sec:appendix_extra_outputs}。
\FloatBarrier

\section{投組績效驗證}
\label{sec:portfolio_performance}

本節比較 GAT、DMFM 與 0050 在不同時間窗的年化報酬、Sharpe 與勝率。回測選股流程為：在每次再平衡日，先依模型預測分數由高至低排序，再選取前 \texttt{top\_pct} 股票等權做多，持有至下一次再平衡。表 \ref{tab:results_portfolio_metrics} 彙整績效指標；圖 \ref{fig:results_cum_returns_grid} 對應呈現 Short/Medium/Long 三種時間窗的累積報酬曲線比較（已收錄於圖目錄）。
其中「對齊的天數」表示策略與 0050 在同一時間軸可直接比較的對齊後樣本天數。

\input{Sections/tables/results_portfolio_metrics.tex}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{img/results_cum_returns_grid.png}
  \caption{GAT 與 DMFM 在 Short/Medium/Long 三種時間窗之累積報酬曲線比較。}
  \label{fig:results_cum_returns_grid}
\end{figure}

由表 \ref{tab:results_portfolio_metrics} 與圖 \ref{fig:results_cum_returns_grid} 搭配比較可得：
\begin{itemize}
  \item \textbf{Short}：DMFM 年化 0.9298、Sharpe 8.002、勝率 0.846，優於 GAT 與 0050。
  \item \textbf{Medium}：DMFM（年化 0.3734、Sharpe 1.274）優於 GAT（0.1158、0.570）與 0050（負年化）。
  \item \textbf{Long}：DMFM 仍維持最佳（年化 0.3131、Sharpe 1.369），GAT 在長窗轉為負年化。
\end{itemize}
完整累積報酬圖（含各時間窗、各模型）見附錄 \ref{sec:appendix_extra_outputs}；其餘回測輸出（Daily IC、IC 分佈、月度命中率等）亦整理於附錄。
\FloatBarrier

\section{特徵重要性排名}
\label{sec:feature_importance}

為了解 DMFM 在不同時間窗下偏好的訊號來源，本節依注意力權重統計前五特徵。表 \ref{tab:results_dmfm_attention} 列出各時間窗的 Top-5 結果，圖 \ref{fig:results_dmfm_attention_top5} 以圖形方式對照相同資訊。

\input{Sections/tables/results_dmfm_attention.tex}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{img/results_dmfm_attention_top5.png}
  \caption{DMFM 在不同時間窗的注意力前五特徵權重。}
  \label{fig:results_dmfm_attention_top5}
\end{figure}

由表 \ref{tab:results_dmfm_attention} 與圖 \ref{fig:results_dmfm_attention_top5} 可得兩項重點：
\begin{itemize}
  \item 區間位置與量價特徵在多個時間窗持續出現（如 \texttt{roll\_max\_5}、\texttt{pct\_to\_low\_20}、\texttt{down\_vol\_20}），顯示 DMFM 偏好結合價格區間與量能訊號。
  \item 流動性與動能訊號仍具影響力（如 \texttt{amihud\_20}、\texttt{amihud\_5}、\texttt{ret\_20}、\texttt{macd\_signal}），反映模型在不同時間窗會切換關注的主導因子。
\end{itemize}
更多注意力與輔助輸出亦整理於附錄 \ref{sec:appendix_extra_outputs}。
\FloatBarrier
